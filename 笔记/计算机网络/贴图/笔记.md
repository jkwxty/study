# 计算机网络基础篇

## OSI标准模型

应用层，表示层，会话层，传输层，网络层，数据链路层，物理层



## 原理体系结构

应用层，运输层，网络层，数据链路层，物理层



### TCP/IP系结构剖析

#### 应用层

##### 描述

在计算机网络体系中处于最上层，我们手机或电脑使用的应用软件都在应用层实现，应用层只关注于为用户提供应用功能（体现了设计模式中的-单一职责原则SRP）,应用层是工作在操作系统中的用户态，传输层以及一下是工作在内核态

#### 传输层

##### 描述

传输层是为应用层提供网络支持的。

传输层有两个协议，分别为**TCP**和**UDP**。

##### TCP

全称:传输层控制协议，可靠，大部分应用使用的就是TCP传输层协议，比如HTTP应用层协议使用的就是TCP传输层协议。

##### UDP

不可靠，传输效率高。

##### 传输层数据分段

应用如果传输的数据非常大。如果直接传输，会不好控制，当传输层接收到应用层的数据超过**MSS**（TCP最大报文长度）时，传输层会将数据进行分段，他的作用是：在传输途中如果有一段数据包丢了，只需要重传这一个分段，而不是将整个数据包重传。这样一个数据包段称为**TCP段**

##### 端口

为什么会有端口概念？

当设备作为接收方时，传输层要将数据包传输给这台设备的某个应用，但是一个设备是很可能会有多个应用的，这些应用都会接收或者传输数据，我们要将设备中的这些应用区分开来，将数据包发送到一个指定应用，就需要用**端口**进行应用间的区分。

#### 网络层

###### 描述

网络层是的主要任务是实现网络之间的互联，进而实现数据包在各个网络之间的传输，但是她并不负责数据的传输任务（并不违背设计原则）

###### IP协议

![8c5dc0d0-e084-4728-95ea-d6d23ceb2586](file:///C:/Users/Administrator/Pictures/Typedown/8c5dc0d0-e084-4728-95ea-d6d23ceb2586.png)

网络层最常用的就是IP协议，IP协议会将传输层的数据包作为IP协议的数据部分，再加上IP包头组成**IP报文**（类似于设计模式中的**装饰模式**，将传输层的数据包进行装饰后再传递给下一层）。

IP报文的大小超过限制也会进行分段（二次分段，传输层进行第一次分段），IP报文长度超过了MTU（以太网中一般为1500字节）时会触发分段

##### 寻址和路由

我们一般用IP地址给设备进行编号，对于IPV4协议，IP地址共32位，分成4段，每段8位。但是，只有一个IP地址，虽做到了设备区分，但是设备量太大，寻址起来太麻烦，因此需要将IP地址分为两种含义:网络号和主机号。

###### 网络号

负责标识该IP是属于那个子网的

###### 主机号

负责标识同一子网下的不同主机

配合**子网掩码**计算出IP地址的网络号和主机号，在寻址过程中，先匹配到对应的网络号再匹配到对应网络号下的主机。除了寻址能力，IP协议还有一个重要的能力就是**路由**。IP协议的**寻址**是告诉我们去下一个目的地该怎么走，**路由**则是根据【下一个目的地】选择路径，寻址是导航，路由是操作的方向盘。



#### 数据链路层

一个用于标识网络中的设备，让数据在一个链路中传输的层级，就是**数据链路层**，它主要是为网络层提供链路级别传输的服务。

 每一台设备的网卡都会有一个**MAC地址**,它就是用来唯一标识设备的。路由器计算出了下一个目的的IP地址，再通过ARP协议找到该目的MAC地址，这样就知道这个IP地址是那个设备的了。

链路：从一个节点到另一个节点的一段物理线路，并且中间不存在任何的其他节点

数据链路：把实现通信协议的硬件和软件加到链路上，就构成了数据链路。数据链路层以帧为单位传输和处理数据

#### 物理层

数据准备从设备发送到网络时，需要把数据包转换成电信号，让其可以在物理媒介中传输，这一层就是**物理层**，它主要是为**数据链路层**提供二进制传输服务。

物理层主要考虑的是怎样在连接各种计算机的传输媒体上传输数据比特流、



## 计算器网络之HTTP

我们在浏览器输入网址后可以访问网站内容，这就是**万维网WWW应用**，其相关的应用层协议为**超文本传输协议HTTP** -- **应用层协议**

### HTTP基本概念

http是超文本传输协议，英文全称：**H**yper**T**ext **T**ransfer **P**rotocal



- 超文本 -- 超越了普通文本的本本，文字，图片，视频。

- 传输 -- http是一个两点之间传输数据的双向协议。

- 协议 -- 两个以上参与者的行为约定和规范。

**HTTP是一个在计算机世界里专门在 【两点】之间 【传输】文字，图片，音频，视频等【超文本】 数据的【约定和规范】**



### HTTP请求响应过程（待补充，后面按自己理解更详细补充）



### HTTP请求特征

简单，灵活，易于扩展，应用广泛，跨平台。

### 持久性连接，非持久性连接

HTTP1.0:  非持久性连接，每次http的请求响应过程，都需要建立一个新的TCP连接。

HTTP1.1：持久性连接。

#### 非持久性的缺点

1. 必须为每个http请求的对象建立和维护一个全新的连接。

2. 对于每个连接，在客户端和服务端都需要为TCP分配一个缓冲区和保持TCP变量，这会给web服务器带来巨大压力，每一台服务器服务会同时维护数百上千的请求。

#### 持久性连接的特点

只要任意一端没有提出断开连接，则会保持TCP连接状态。



### HTTP报文格式

##### 组成部分

- 起始行

- 头部字段

- 消息正文 -- 使用GET方法是没有消息正 文的，POST方法才会有实体
  
  

## 计算机网络之TCP

### 什么是TCP

- ###### 面向连接：TCP只能一对一连接，不能一对多（UDP才能一对多）

- ###### 可靠的:  TCP能保证发送端的每一个报文都能到达接收端

- ###### 字节流: 消息是没有边界的，无论多大都可以进行传输。消息也是【有序】的，当发送端的前一个消息在接收端还没收到时，即使它已经收到了后面的消息，接收端也还不能吧这个报文数据交给应用处理，接收端会先对数据进行去重，并且保证数据有序性和完整性。

TCP连接是全双工服务，指的是，如果存在一条TCP连接，那么双方都可以互相发送接收数据。
TCP会将数据临时存放到缓冲区，**发送缓冲区**，**接收缓冲区**。
TCP会将需要传输的数据分为多个TCP段俗称报文段（TCP头+TCP数据），每一个TCP报文段的传输长度是有限的，他的最大长度为**MSS--最大报文段长度**（不包含TCP头部信息）。在TCP报文段向下传输的过程中，会经过网络层，网络层有一个**最大传输单元--MTU**，**MTU=MSS+IP HEARD(头部固定长度为20)+TCP HEARD（头部固定长度为20)** 他们的区别如下

### MSS和MTU的区别

| S.NO | MSS                                     | MTU                                       |
| ---- | --------------------------------------- | ----------------------------------------- |
| 1.   | MSS表示最大TCP段大小。                          | MTU表示最大传输单元协议。                            |
| 2.   | MSS对TCP报头使用三次握手协议。                      | MTU没有对TCP报头使用握手协议。                        |
| 3.   | 相对于MTU协议的较低值，MSS不需要对数据包进行分片。            | 相对于MTU协议的较低值，MSS对数据报文进行分片处理。              |
| 4.   | 它计算并确定发生在TCP协议的每一层传输和隧道模式的分段的数量。        | 它不确定每一层TCP协议中的分段数量。                       |
| 5.   | 它不具备任何跨网络路由器的数据传输能力。                    | 它决定了网络网关能够从一个路由器终端传输到另一个路由器终端的最大数据字节量的能力。 |
| 6.   | 它使用TCP/IP的第四层协议。                        | 它使用TCP/IP的第二层协议。                          |
| 7.   | 它决定了用于传输的数据块载荷的最大大小。                    | 它决定了在两个网络路由器之间传输的最大数据量。                   |
| 8.   | MSS = MTU – 40 (IP header + TCP header) | MTU = MSS + 40 (IP header + TCP header)   |

![5ee8d3ca-242a-4bc2-97cb-b1cabf31e335](file:///C:/Users/Administrator/jkw/%E5%AD%A6%E4%B9%A0/study/%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%B4%B4%E5%9B%BE/img/5ee8d3ca-242a-4bc2-97cb-b1cabf31e335.png) 

### TCP头部格式

![8de1e412-331a-4dca-bab2-f111419226d6](file:///C:/Users/Administrator/jkw/%E5%AD%A6%E4%B9%A0/study/%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%B4%B4%E5%9B%BE/img/8de1e412-331a-4dca-bab2-f111419226d6.png)

#### TCP 端口号

TCP的连接是需要四个要素确定连接唯一：
（源IP，源端口号）+ （目地IP，目的端口号）
所以TCP首部预留了两个16位作为端口号的存储，而IP地址由上一层IP协议负责传递
源端口号和目地端口各占16位两个字节，也就是端口的范围是2^16=65535
另外1024以下端口是系统保留的，从1024-65535是用户使用的端口范围。

#### TCP 的序号和确认号

32位序号 seq：Sequence number 缩写seq ，TCP通信过程中某一个传输方向上的字节流的每个字节的序号，通过这个来确认发送的数据有序，也可以理解为：本次传输数据的起始字节在整个数据流中的位置。比如现在序列号为1000，发送了1000，下一个序列号就是2000。
32位确认号 ack：Acknowledge number 缩写ack，TCP对上一次seq序号做出的确认号，用来响应TCP报文段，给收到的TCP报文段的序号seq加1。也可以理解为： 期望收到下一包的序号，用于确认已经收到数据的偏移序号。

#### 数据偏移（4位首部长度）

占4位，它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远。这个字段指出TCP报文段的首部长度（报头长度）。由于首部中还有长度不确定的选项字段，因此数据偏移字段是必要的，注意，**“数据偏移”的单位不是位，而是4字节**。由于4位二进制数能表示的最大十进制数字是15，因此数据偏移的最大值是60字节（15*4字节），这也是TCP首部的最大字节（即选项长度不能超过40字节=60-20）。

首部长度（报头长度） - 20字节 = 选项长度 如果数据偏移的值是5，此时表示整个TCP报头的长度是 4\*5 = 20字节(此时相当于没有选项) 如果数据偏移的值是15，此时表示整个TCP报头的长度是4*15 = 60字节(此时相当于选项是40个字节) 、

#### 保留

填充为0

#### TCP 的标志位

6位标志位，它们中的多个可同时被设置为1。每个TCP段都有一个目的，这是借助于TCP标志位选项来确定的，允许发送方或接收方指定哪些标志应该被使用，以便段被另一端正确处理。
用的最广泛的标志是 SYN，ACK 和 FIN，用于建立连接，确认成功的段传输，最后终止连接。

1. URG：简写为U，紧急标志位，表示数据包的紧急指针域有效，用来保证连接不被阻断，并督促中间设备尽快处理；
   
   

2. ACK：简写为.，确认标志位，对已接收的数据包进行确认；

3. PSH：简写为P，推送标志位，表示该数据包被对方接收后应立即交给上层应用，而不在缓冲区排队；

4. RST：简写为R，重置标志位，用于连接复位、拒绝错误和非法的数据包；

5. SYN：简写为S，同步标志位，用于建立会话连接，同步序列号；

6. FIN： 简写为F，完成标志位，表示我已经没有数据要发送了，即将关闭连接；

##### 紧急 URG

当URG=1时，表明紧急指针字段有效。它告诉系统此报文段中有紧急数据，应尽快发送（相当于高优先级的数据），而不要按原来的排队顺序来传送。例如，已经发送了很长的一个程序要在远地的主机上运行。但后来发现了一些问题，需要取消该程序的运行，因此用户从键盘发出中断命令。如果不使用紧急数据，那么这两个字符将存储在接收TCP的缓存末尾。只有在所有的数据被处理完毕后这两个字符才被交付接收方的应用进程。这样做就浪费了很多时间。当URG置为1时，发送应用进程就告诉发送方的TCP有紧急数据要传送。于是发送方TCP就把紧急数据插入到本报文段数据的最前面，而在紧急数据后面的数据仍然是普通数据。这时要与首部中紧急指针（Urgent Pointer）字段配合使用。

##### 确认 ACK

仅当 ACK = 1时确认号字段才有效，当 ACK = 0时确认号无效。TCP 规定，在连接建立后所有的传送的报文段都必须把 ACK 置为1。

##### 推送 PSH

当两个应用进程进行交互式的通信时，有时在一端的应用进程希望在键入一个命令后立即就能收到对方的响应。在这种情况下，TCP 就可以使用推送（push）操作。这时，发送方 TCP 把 PSH 置为1，并立即创建一个报文段发送出去。接收方 TCP 收到 PSH =1的报文段，就尽快地（即“推送”向前）交付接收应用进程。而不用再等到整个缓存都填满了后再向上交付。一般这个不需要手动执标志，TCP 默认实现。

##### 复位 RST

当 RST = 1时，表名 TCP 连接中出现了严重错误（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立传输连接。RST 置为1还用来拒绝一个非法的报文段或拒绝打开一个连接。

##### 同步 SYN

在连接建立时用来同步序号。当 SYN = 1而 ACK = 0时，表明这是一个连接请求报文段。对方若同意建立连接，则应在响应的报文段中使 SYN = 1和 ACK = 1，因此 SYN 置为1就表示这是一个连接请求或连接接受报文。

终止 FIN

发送端完成任务，表要求释放运输连接。



### TCP和UDP的区别

| **类型** | **面向连接** | **传输可靠性** | **传输速率** | **所需资源** | **应用场景**           | **首部长度** |
| ------ | -------- | --------- | -------- | -------- | ------------------ | -------- |
| TCP    | 面向连接     | 可靠        | 慢        | 多        | 要求数据传输可靠（如文件、邮件传输） | 20~60字节  |
| UDP    | 无连接      | 不保证可靠     | 快        | 少        | 要求通信速度快（如视频，音频）    | 8字节      |



### TCP的三次握手和四次挥手

#### TCP三次握手流程

#### TCP为什么要三次握手？不是两次也不是四次？

[TCP为什么三次握手？_tcp为什么要三次握手_右眸Remnant的博客-CSDN博客](https://blog.csdn.net/qq_45888932/article/details/123990813)

#### TCP四次挥手流程

#### TCP为什么要四次挥手？


